!function(){!function(){let e=document.querySelector(".team__list");e.addEventListener("click",function(t){if(t.preventDefault(),t.target.classList.contains("member__link")){let n=t.target,c=e.querySelector(".member.is-active");if(c&&(c.querySelector(".member__text").style.height="0px",c.classList.remove("is-active")),!c||c.querySelector(".member__link")!=n){let e=n.closest(".member");e.classList.add("is-active");let t=e.querySelector(".member__text");t.style.height=t.scrollHeight+"px"}}})}(),function(){let e=document.querySelectorAll(".menu__block"),t=document.querySelector("body");e.forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();let n=this,c=document.querySelector(".menu__item.is-active");if(c&&(c.querySelector(".menu__desc").style.width="0px",c.classList.remove("is-active")),!c||c.querySelector(".menu__block")!=n){let e=n.closest(".menu__item");e.classList.add("is-active");let c=e.querySelector(".menu__desc");t.offsetWidth>480?c.style.width=function(){let e=document.documentElement.clientWidth,t=document.querySelectorAll(".menu__block"),n=e-parseFloat(getComputedStyle(t[0]).width)*t.length;return n>550?550:n}()+"px":c.style.width="100%"}})})}()}();const menu=function(){let e=document.querySelector(".menu-btn"),t=document.querySelector(".header"),n=document.querySelector("body"),c=document.querySelector(".nav__list"),o=!1;function l(){e.classList.toggle("is-active"),t.classList.toggle("is-active"),n.classList.toggle("locked"),o=!o}return document.addEventListener("keydown",function(e){27==e.keyCode&&o&&l()}),{menuOver:function(){e.addEventListener("click",l),c.addEventListener("click",function(e){e.target.classList.contains("nav__link")&&n.offsetWidth<=768&&l()})}}}();menu.menuOver();let OnePageScroll=function(){const e=document,t=e.querySelector(".wrapper"),n=e.querySelector("#content"),c=e.querySelectorAll(".section");let o,l,i=e.querySelectorAll(".nav__link"),s=e.querySelectorAll(".listing__item"),r=!1;function a(t){if(!r){r=!0;let c=-100*t+"%";n.style.top=c,e.querySelector(".listing__item.is-active").classList.remove("is-active"),s[t].classList.add("is-active"),setTimeout(function(){r=!1},700)}}e.addEventListener("keyup",function(e){let t=n.style.top?-parseInt(n.style.top,10)/100:0;38==e.keyCode&&t>0&&a(--t),40==e.keyCode&&t<c.length-1&&a(++t)}),t.addEventListener("wheel",function(e){!function(e){let t=n.style.top?-parseInt(n.style.top,10)/100:0;"up"==e&&t>0&&a(--t),"down"==e&&t<c.length-1&&a(++t)}(e.deltaY<0?"up":"down")}),t.addEventListener("touchmove",function(e){e.preventDefault()}),t.addEventListener("touchstart",function(e){o=e.touches[0].clientX,l=e.touches[0].clientY},!1),t.addEventListener("touchend",function(e){let t=n.style.top?-parseInt(n.style.top,10)/100:0,i=e.changedTouches[0].clientX-o,s=e.changedTouches[0].clientY-l;Math.abs(s)-Math.abs(i)>0&&(s>0&&t>0&&a(--t),s<0&&t<c.length-1&&a(++t))},!1),i.forEach(function(e){e.addEventListener("click",function(e){e.preventDefault(),a(this.dataset.index)})}),s.forEach(function(e){e.addEventListener("click",function(e){e.preventDefault(),link=e.target,a(link.dataset.index)})}),e.querySelector(".intro-button").addEventListener("click",function(e){e.preventDefault(),a(7)})};OnePageScroll();const overlay=function(){let e=document.querySelector("body"),t=document.querySelector(".modal"),n=document.querySelector(".modal__inner"),c=document.createElement("div");c.classList.add("modal__text");let o=document.createElement("button"),l=function(){t.classList.remove("is-active"),e.classList.remove("locked")};return{open:function(i,s){c.textContent=i,s?(o.classList.add("order-button"),o.textContent="Закрыть"):o.classList.add("modal__close"),n.appendChild(c),n.appendChild(o),t.classList.add("is-active"),e.classList.add("locked"),o.addEventListener("click",e=>{e.preventDefault(),l()}),t.addEventListener("click",e=>{e.target===t&&l()}),document.addEventListener("keydown",e=>{27===e.keyCode&&l()})},close:l}}(),ajaxForm=function(e){let t=new FormData;t.append("name",e.elements.name.value),t.append("phone",e.elements.phone.value),t.append("comment",e.elements.textarea.value),t.append("to","client@mail.ru");const n=new XMLHttpRequest;return n.responseType="json",n.open("POST","https://webdev-api.loftschool.com/sendmail"),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.send(t),n},submitForm=function(e){e.preventDefault();let t=document.querySelector("#order-form"),n=ajaxForm(t);n.addEventListener("load",()=>{let e=!1;if(n.status>=400){let t="Ошибка соединения с сервером, попробуйте позже";overlay.open(`${t}. Ошибка ${n.status}`,e)}else 0==n.response.status?(content=n.response.message,overlay.open(content,e)):(content="Сообщение отправлено",e=!0,overlay.open(content,e))})},form=document.querySelector("#order-form");form.addEventListener("submit",submitForm),function(){let e=document,t=e.querySelector(".candy-bar__list"),n=e.querySelectorAll(".candy-bar__item").length,c=e.querySelector(".candy-bar__slider"),o=e.querySelector("#back"),l=e.querySelector("#forward"),i=0;var s,r;function a(){t.style.transform="translateX("+-i*c.offsetWidth+"px)"}function u(e,t){var n=!1;return function(){n||(e.apply(this,arguments),n=!0,setTimeout(function(){n=!1},t))}}let d=u(function(){0==i?i=n-1:i--,a()},600),m=u(function(){i==n-1?i=0:i++,a()},600);o.addEventListener("click",d),l.addEventListener("click",m),window.addEventListener("resize",a),c.addEventListener("touchstart",function(e){s=e.touches[0].clientX,r=e.touches[0].clientY},!1),c.addEventListener("touchend",function(e){var t,n;t=e.changedTouches[0].clientX-s,n=e.changedTouches[0].clientY-r;var c=Math.abs(t)-Math.abs(n);t<0&&c>0?m():t>0&&c>0&&d()},!1)}(),function(){const e=document.querySelectorAll(".reviews__item"),t=document.querySelectorAll(".reviews__pix-item");let n=0;for(let c=0;c<e.length;c++)t[c].addEventListener("click",function(o){o.preventDefault(),e[c].classList.toggle("is-active"),t[c].classList.toggle("is-active"),t[n].classList.toggle("is-active"),e[n].classList.toggle("is-active"),n=c})}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjY29yZGVvbi5qcyIsIm1lbnUuanMiLCJvcHMuanMiLCJyZXF1ZXN0LmpzIiwic2xpZGVyLmpzIiwic2xpZGVzaG93LmpzIl0sIm5hbWVzIjpbInRlYW0iLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsInByZXZlbnREZWZhdWx0IiwidGFyZ2V0IiwiY2xhc3NMaXN0IiwiY29udGFpbnMiLCJsaW5rIiwiYWN0aXZlIiwic3R5bGUiLCJoZWlnaHQiLCJyZW1vdmUiLCJjdXJyZW50IiwiY2xvc2VzdCIsImFkZCIsImN1cnJlbnRUZXh0Iiwic2Nyb2xsSGVpZ2h0IiwiYWN0aXZhdGVUZWFtIiwibGlua3MiLCJxdWVyeVNlbGVjdG9yQWxsIiwiYm9keSIsImZvckVhY2giLCJlbGVtIiwidGhpcyIsIndpZHRoIiwib2Zmc2V0V2lkdGgiLCJkb2N1bWVudEVsZW1lbnQiLCJjbGllbnRXaWR0aCIsInJlcVdpZHRoIiwicGFyc2VGbG9hdCIsImdldENvbXB1dGVkU3R5bGUiLCJsZW5ndGgiLCJ3aWR0aENhbGMiLCJhY3RpdmF0ZU1lbnUiLCJtZW51IiwiYnV0dG9uIiwiaGVhZGVyIiwibmF2IiwiYWN0IiwidG9nZ2xlTWVudSIsInRvZ2dsZSIsImtleUNvZGUiLCJtZW51T3ZlciIsIk9uZVBhZ2VTY3JvbGwiLCJkIiwid3JhcHBlciIsImNvbnRlbnQiLCJzZWN0aW9ucyIsImNsaWVudFgiLCJjbGllbnRZIiwibWVudUxpbmtzIiwicG9pbnRzIiwicGF1c2UiLCJtb3ZlQ29udGVudCIsImluZGV4IiwicG9zIiwidG9wIiwic2V0VGltZW91dCIsImN1cnJlbnRQb3MiLCJwYXJzZUludCIsIndheSIsInNjcm9sbCIsImRlbHRhWSIsInRvdWNoZXMiLCJkZWx0YVgiLCJjaGFuZ2VkVG91Y2hlcyIsIk1hdGgiLCJhYnMiLCJkYXRhc2V0Iiwib3ZlcmxheSIsIm1vZGFsIiwibW9kYWxJbm5lciIsIm1vZGFsVGV4dCIsImNyZWF0ZUVsZW1lbnQiLCJjbG9zZU92ZXJsYXkiLCJvcGVuIiwicmVwbHkiLCJ0ZXh0Q29udGVudCIsImFwcGVuZENoaWxkIiwiY2xvc2UiLCJhamF4Rm9ybSIsImZvcm0iLCJkYXRhIiwiRm9ybURhdGEiLCJhcHBlbmQiLCJlbGVtZW50cyIsIm5hbWUiLCJ2YWx1ZSIsInBob25lIiwidGV4dGFyZWEiLCJ4aHIiLCJYTUxIdHRwUmVxdWVzdCIsInJlc3BvbnNlVHlwZSIsInNldFJlcXVlc3RIZWFkZXIiLCJzZW5kIiwic3VibWl0Rm9ybSIsInJlcXVlc3QiLCJzdGF0dXMiLCJyZXNwb25zZSIsIm1lc3NhZ2UiLCJsaXN0IiwiaXRlbUNvdW50Iiwic2xpZGVyIiwiYmFjayIsImZvcndhcmQiLCJzZXRUcmFuc2Zvcm0iLCJ0cmFuc2Zvcm0iLCJ0aHJvdHRsZSIsImZ1bmMiLCJtcyIsInN0b3AiLCJhcHBseSIsImFyZ3VtZW50cyIsInRyb3R0bGVQcmV2IiwidHJvdHRsZU5leHQiLCJ3aW5kb3ciLCJtb2QiLCJpdGVtcyIsInBpeCIsImkiXSwibWFwcGluZ3MiOiJDQUFBLFlBV0EsV0FDQSxJQUFBQSxFQUFBQyxTQUFBQyxjQUFBLGVBQ0FGLEVBQUFHLGlCQUFBLFFBQUEsU0FBQUMsR0FFQSxHQURBQSxFQUFBQyxpQkFDQUQsRUFBQUUsT0FBQUMsVUFBQUMsU0FBQSxnQkFBQSxDQUNBLElBQUFDLEVBQUFMLEVBQUFFLE9BRUFJLEVBQUFWLEVBQUFFLGNBQUEscUJBT0EsR0FMQVEsSUFDQUEsRUFBQVIsY0FBQSxpQkFDQVMsTUFBQUMsT0FBQSxNQUNBRixFQUFBSCxVQUFBTSxPQUFBLGVBRUFILEdBQUFBLEVBQUFSLGNBQUEsa0JBQUFPLEVBQUEsQ0FDQSxJQUFBSyxFQUFBTCxFQUFBTSxRQUFBLFdBQ0FELEVBQUFQLFVBQUFTLElBQUEsYUFFQSxJQUFBQyxFQUFBSCxFQUFBWixjQUFBLGlCQUNBZSxFQUFBTixNQUFBQyxPQUFBSyxFQUFBQyxhQUFBLFNBS0FDLEdBRUEsV0FDQSxJQUFBQyxFQUFBbkIsU0FBQW9C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QUE5QyxFQUFBNkQsUUFBQSxHQUFBZixRQUNBQyxFQUFBL0MsRUFBQTZELFFBQUEsR0FBQWQsVUFDQSxHQUVBcUQsRUFBQXJHLGlCQUFBLFdBQUEsU0FBQUMsR0FDQSxJQUFBOEQsRUFBQUYsRUFFQUUsRUFBQTlELEVBQUErRCxlQUFBLEdBQUFqQixRQUFBQSxFQUNBYyxFQUFBNUQsRUFBQStELGVBQUEsR0FBQWhCLFFBQUFBLEVBQ0EsSUFBQW1FLEVBQUFsRCxLQUFBQyxJQUFBSCxHQUFBRSxLQUFBQyxJQUFBTCxHQUVBRSxFQUFBLEdBQUFvRCxFQUFBLEVBQ0FGLElBQ0FsRCxFQUFBLEdBQUFvRCxFQUFBLEdBQ0FILE1BRUEsR0EzRUEsR0NBQSxXQUNBLE1BQUFJLEVBQUF0SCxTQUFBb0IsaUJBQUEsa0JBQ0FtRyxFQUFBdkgsU0FBQW9CLGlCQUFBLHNCQUNBLElBQUFYLEVBQUEsRUFFQSxJQUFBLElBQUErRyxFQUFBLEVBQUFBLEVBQUFGLEVBQUF0RixPQUFBd0YsSUFDQUQsRUFBQUMsR0FBQXRILGlCQUFBLFFBQUEsU0FBQUMsR0FDQUEsRUFBQUMsaUJBQ0FrSCxFQUFBRSxHQUFBbEgsVUFBQW1DLE9BQUEsYUFDQThFLEVBQUFDLEdBQUFsSCxVQUFBbUMsT0FBQSxhQUVBOEUsRUFBQTlHLEdBQUFILFVBQUFtQyxPQUFBLGFBQ0E2RSxFQUFBN0csR0FBQUgsVUFBQW1DLE9BQUEsYUFDQWhDLEVBQUErRyxJQWJBIiwiZmlsZSI6InNjcmlwdC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtcclxuXHJcbiAgZnVuY3Rpb24gd2lkdGhDYWxjKCkge1xyXG4gICAgbGV0IHdpZHRoID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoO1xyXG4gICAgbGV0IGxpbmtzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1lbnVfX2Jsb2NrJyk7XHJcbiAgICBsZXQgbGlua1dpZHRoID0gcGFyc2VGbG9hdChnZXRDb21wdXRlZFN0eWxlKGxpbmtzWzBdKS53aWR0aCk7XHJcblxyXG4gICAgbGV0IHJlcVdpZHRoID0gd2lkdGggLSBsaW5rV2lkdGggKiBsaW5rcy5sZW5ndGg7XHJcbiAgICByZXR1cm4gcmVxV2lkdGggPiA1NTAgPyA1NTAgOiByZXFXaWR0aDtcclxuICB9XHJcbiAgXHJcbiAgZnVuY3Rpb24gYWN0aXZhdGVUZWFtKCkge1xyXG4gICAgbGV0IHRlYW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudGVhbV9fbGlzdCcpOyAgIFxyXG4gICAgdGVhbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICBpZihlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21lbWJlcl9fbGluaycpKXtcclxuICAgICAgICBsZXQgbGluayA9IGUudGFyZ2V0O1xyXG5cclxuICAgICAgICBsZXQgYWN0aXZlID0gdGVhbS5xdWVyeVNlbGVjdG9yKCcubWVtYmVyLmlzLWFjdGl2ZScpO1xyXG5cclxuICAgICAgICBpZihhY3RpdmUpIHtcclxuICAgICAgICAgIGxldCBhY3RpdmVUZXh0ID0gYWN0aXZlLnF1ZXJ5U2VsZWN0b3IoJy5tZW1iZXJfX3RleHQnKTsgICAgICAgICAgXHJcbiAgICAgICAgICBhY3RpdmVUZXh0LnN0eWxlLmhlaWdodCA9ICcwcHgnO1xyXG4gICAgICAgICAgYWN0aXZlLmNsYXNzTGlzdC5yZW1vdmUoJ2lzLWFjdGl2ZScpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZighYWN0aXZlIHx8IGFjdGl2ZS5xdWVyeVNlbGVjdG9yKCcubWVtYmVyX19saW5rJykgIT0gbGluaykge1xyXG4gICAgICAgICAgbGV0IGN1cnJlbnQgID0gbGluay5jbG9zZXN0KCcubWVtYmVyJyk7XHJcbiAgICAgICAgICBjdXJyZW50LmNsYXNzTGlzdC5hZGQoJ2lzLWFjdGl2ZScpO1xyXG5cclxuICAgICAgICAgIGxldCBjdXJyZW50VGV4dCA9IGN1cnJlbnQucXVlcnlTZWxlY3RvcignLm1lbWJlcl9fdGV4dCcpO1xyXG4gICAgICAgICAgY3VycmVudFRleHQuc3R5bGUuaGVpZ2h0ID0gY3VycmVudFRleHQuc2Nyb2xsSGVpZ2h0ICsgJ3B4JztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pICAgIFxyXG4gIH1cclxuICBhY3RpdmF0ZVRlYW0oKVxyXG5cclxuICBmdW5jdGlvbiBhY3RpdmF0ZU1lbnUoKSB7XHJcbiAgICBsZXQgbGlua3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubWVudV9fYmxvY2snKTtcclxuICAgIGxldCBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpOyAgXHJcbiAgICBsaW5rcy5mb3JFYWNoKGZ1bmN0aW9uKGVsZW0pe1xyXG4gICAgICBlbGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSl7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIGxldCBsaW5rID0gdGhpczsgICAgICAgIFxyXG4gICAgICAgIGxldCBhY3RpdmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWVudV9faXRlbS5pcy1hY3RpdmUnKTtcclxuXHJcbiAgICAgICAgaWYoYWN0aXZlKSB7XHJcbiAgICAgICAgICBsZXQgYWN0aXZlVGV4dCA9IGFjdGl2ZS5xdWVyeVNlbGVjdG9yKCcubWVudV9fZGVzYycpOyAgICAgICAgICBcclxuICAgICAgICAgIGFjdGl2ZVRleHQuc3R5bGUud2lkdGggPSAnMHB4JztcclxuICAgICAgICAgIGFjdGl2ZS5jbGFzc0xpc3QucmVtb3ZlKCdpcy1hY3RpdmUnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKCFhY3RpdmUgfHwgYWN0aXZlLnF1ZXJ5U2VsZWN0b3IoJy5tZW51X19ibG9jaycpICE9IGxpbmspIHtcclxuICAgICAgICAgIGxldCBjdXJyZW50ICA9IGxpbmsuY2xvc2VzdCgnLm1lbnVfX2l0ZW0nKTtcclxuICAgICAgICAgIGN1cnJlbnQuY2xhc3NMaXN0LmFkZCgnaXMtYWN0aXZlJyk7XHJcblxyXG4gICAgICAgICAgbGV0IGN1cnJlbnRUZXh0ID0gY3VycmVudC5xdWVyeVNlbGVjdG9yKCcubWVudV9fZGVzYycpO1xyXG4gICAgICAgICAgaWYgKGJvZHkub2Zmc2V0V2lkdGggPiA0ODApIHtcclxuICAgICAgICAgIGN1cnJlbnRUZXh0LnN0eWxlLndpZHRoID0gd2lkdGhDYWxjKCkgKyAncHgnO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY3VycmVudFRleHQuc3R5bGUud2lkdGggPSAnMTAwJSc7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSAgICAgIFxyXG4gICAgICB9KVxyXG4gICAgfSlcclxuICB9XHJcbiAgYWN0aXZhdGVNZW51KCk7ICBcclxufSgpKTtcclxuXHJcblxyXG4gICIsImNvbnN0IG1lbnUgPSAoZnVuY3Rpb24oKSB7XHJcbiAgbGV0IGJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tZW51LWJ0bicpO1xyXG4gIGxldCBoZWFkZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGVhZGVyJyk7XHJcbiAgbGV0IGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7XHJcbiAgbGV0IG5hdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5uYXZfX2xpc3QnKTtcclxuICBsZXQgYWN0ID0gZmFsc2U7XHJcblxyXG4gIGZ1bmN0aW9uIHRvZ2dsZU1lbnUoKSB7XHJcbiAgICAgIGJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKCdpcy1hY3RpdmUnKTtcclxuICAgICAgaGVhZGVyLmNsYXNzTGlzdC50b2dnbGUoJ2lzLWFjdGl2ZScpO1xyXG4gICAgICBib2R5LmNsYXNzTGlzdC50b2dnbGUoJ2xvY2tlZCcpO1xyXG5cclxuICAgICAgYWN0ID8gYWN0ID0gZmFsc2UgOiBhY3QgPSB0cnVlO1xyXG4gIH1cclxuXHJcbiAgbGV0IGFkZExpc3RlbmVycyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRvZ2dsZU1lbnUpO1xyXG5cclxuICAgICAgICBuYXYuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKXtcclxuICAgICAgICAgIGxldCB0YXJnZXQgPSBlLnRhcmdldDtcclxuICAgICAgICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCduYXZfX2xpbmsnKSAmJiBib2R5Lm9mZnNldFdpZHRoIDw9IDc2OCkge1xyXG4gICAgICAgICAgICB0b2dnbGVNZW51KCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGZ1bmN0aW9uKGUpe1xyXG4gICAgICAgIGlmIChlLmtleUNvZGUgPT0gMjcgJiYgYWN0KSB7XHJcbiAgICAgICAgICB0b2dnbGVNZW51KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gIHJldHVybiB7XHJcbiAgICBtZW51T3ZlcjogYWRkTGlzdGVuZXJzICBcclxuICB9XHJcbn0oKSk7XHJcbm1lbnUubWVudU92ZXIoKTsiLCJsZXQgT25lUGFnZVNjcm9sbCA9IGZ1bmN0aW9uKCl7XHJcbiAgY29uc3QgZCA9IGRvY3VtZW50O1xyXG4gIGNvbnN0IHdyYXBwZXIgPSBkLnF1ZXJ5U2VsZWN0b3IoJy53cmFwcGVyJyk7XHJcbiAgY29uc3QgY29udGVudCA9IGQucXVlcnlTZWxlY3RvcignI2NvbnRlbnQnKTtcclxuICBjb25zdCBzZWN0aW9ucyA9IGQucXVlcnlTZWxlY3RvckFsbCgnLnNlY3Rpb24nKTtcclxuICBsZXQgbWVudUxpbmtzID0gZC5xdWVyeVNlbGVjdG9yQWxsKCcubmF2X19saW5rJyk7ICBcclxuICBsZXQgcG9pbnRzID0gZC5xdWVyeVNlbGVjdG9yQWxsKCcubGlzdGluZ19faXRlbScpO1xyXG4gIGxldCBwYXVzZSA9IGZhbHNlO1xyXG4gIFxyXG4gIGZ1bmN0aW9uIG1vdmVDb250ZW50KGluZGV4KSB7XHJcbiAgICBpZiAoIXBhdXNlKSB7XHJcbiAgICAgIHBhdXNlID0gdHJ1ZTtcclxuICAgIGxldCBwb3MgPSBpbmRleCAqIC0xMDAgKyAnJSc7XHJcbiAgICBjb250ZW50LnN0eWxlLnRvcCA9IHBvcztcclxuXHJcbiAgICBsZXQgYWN0aXZlID0gZC5xdWVyeVNlbGVjdG9yKCcubGlzdGluZ19faXRlbS5pcy1hY3RpdmUnKTtcclxuICAgIGFjdGl2ZS5jbGFzc0xpc3QucmVtb3ZlKCdpcy1hY3RpdmUnKTtcclxuICAgIHBvaW50c1tpbmRleF0uY2xhc3NMaXN0LmFkZCgnaXMtYWN0aXZlJyk7XHJcblxyXG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyAgICAgICAgXHJcbiAgICAgICAgcGF1c2UgPSBmYWxzZTtcclxuICAgICAgfSw3MDApXHJcbiAgICB9ICAgXHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBzY3JvbGwod2F5KSB7XHJcbiAgICBsZXQgY3VycmVudFBvcyA9ICghY29udGVudC5zdHlsZS50b3AgPyAwIDogLShwYXJzZUludChjb250ZW50LnN0eWxlLnRvcCwgMTApLzEwMCkpO1xyXG4gICAgaWYgKHdheSA9PSAndXAnICYmIGN1cnJlbnRQb3MgPiAwKSB7XHJcbiAgICAgIGN1cnJlbnRQb3MtLTtcclxuICAgICAgbW92ZUNvbnRlbnQoY3VycmVudFBvcyk7XHJcbiAgICB9XHJcbiAgICBpZih3YXkgPT0gJ2Rvd24nICYmIGN1cnJlbnRQb3MgPCBzZWN0aW9ucy5sZW5ndGgtMSkge1xyXG4gICAgICBjdXJyZW50UG9zKys7XHJcbiAgICAgIG1vdmVDb250ZW50KGN1cnJlbnRQb3MpO1xyXG4gICAgfSBcclxuICB9XHJcblxyXG4gIGQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBmdW5jdGlvbihlKSB7XHJcbiAgICBsZXQgY3VycmVudFBvcyA9ICghY29udGVudC5zdHlsZS50b3AgPyAwIDogLShwYXJzZUludChjb250ZW50LnN0eWxlLnRvcCwgMTApLzEwMCkpOyBcclxuICAgIGlmIChlLmtleUNvZGUgPT0gMzggJiYgY3VycmVudFBvcyA+IDApIHsgICAgICBcclxuICAgICAgY3VycmVudFBvcy0tO1xyXG4gICAgICBtb3ZlQ29udGVudChjdXJyZW50UG9zKTtcclxuICAgIH1cclxuICAgIGlmIChlLmtleUNvZGUgPT0gNDAgJiYgY3VycmVudFBvcyA8IHNlY3Rpb25zLmxlbmd0aC0xKSB7ICAgICAgXHJcbiAgICAgIGN1cnJlbnRQb3MrKztcclxuICAgICAgbW92ZUNvbnRlbnQoY3VycmVudFBvcyk7XHJcbiAgICAgfVxyXG4gIH0pXHJcbiAgXHJcbiAgd3JhcHBlci5hZGRFdmVudExpc3RlbmVyKCd3aGVlbCcsIGZ1bmN0aW9uKGUpIHtcclxuICAgIGxldCB3YXkgPSBlLmRlbHRhWSA8IDAgPyAndXAnIDogJ2Rvd24nO1xyXG4gICAgc2Nyb2xsKHdheSk7XHJcbiAgfSlcclxuICB3cmFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIGZ1bmN0aW9uKGUpIHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICB9KVxyXG5cclxuICBsZXQgY2xpZW50WDtcclxuICBsZXQgY2xpZW50WTtcclxuICB3cmFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBmdW5jdGlvbihlKSB7ICBcclxuICAgIGNsaWVudFggPSBlLnRvdWNoZXNbMF0uY2xpZW50WDtcclxuICAgIGNsaWVudFkgPSBlLnRvdWNoZXNbMF0uY2xpZW50WTtcclxuICB9LCBmYWxzZSk7XHJcblxyXG4gIHdyYXBwZXIuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBmdW5jdGlvbihlKSB7XHJcbiAgICBsZXQgY3VycmVudFBvcyA9ICghY29udGVudC5zdHlsZS50b3AgPyAwIDogLShwYXJzZUludChjb250ZW50LnN0eWxlLnRvcCwgMTApLzEwMCkpO1xyXG4gICAgbGV0IGRlbHRhWCA9IGUuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WCAtIGNsaWVudFg7XHJcbiAgICBsZXQgZGVsdGFZID0gZS5jaGFuZ2VkVG91Y2hlc1swXS5jbGllbnRZIC0gY2xpZW50WTtcclxuICAgIGxldCBtb2QgPSBNYXRoLmFicyhkZWx0YVkpIC0gTWF0aC5hYnMoZGVsdGFYKTtcclxuXHJcbiAgICBpZiAobW9kID4gMCkge1xyXG4gICAgICBpZiAoZGVsdGFZID4gMCAmJiBjdXJyZW50UG9zID4gMCkgeyAgICAgIFxyXG4gICAgICAgIGN1cnJlbnRQb3MtLTtcclxuICAgICAgICBtb3ZlQ29udGVudChjdXJyZW50UG9zKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoZGVsdGFZIDwgMCAmJiBjdXJyZW50UG9zIDwgc2VjdGlvbnMubGVuZ3RoLTEpIHsgICAgICBcclxuICAgICAgICBjdXJyZW50UG9zKys7XHJcbiAgICAgICAgbW92ZUNvbnRlbnQoY3VycmVudFBvcyk7XHJcbiAgICAgICB9XHJcbiAgICB9ICAgIFxyXG4gIH0sIGZhbHNlKTtcclxuXHJcbiAgbWVudUxpbmtzLmZvckVhY2goZnVuY3Rpb24oZWxlbSkgeyAgICBcclxuICAgIGVsZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKXtcclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICBsZXQgaW5kZXggPSB0aGlzLmRhdGFzZXQuaW5kZXg7ICAgICAgICBcclxuICAgICAgbW92ZUNvbnRlbnQoaW5kZXgpO1xyXG4gICAgfSkgICAgICBcclxuICB9KVxyXG5cclxuICBwb2ludHMuZm9yRWFjaChmdW5jdGlvbihlbGVtKSB7XHJcbiAgICBlbGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSl7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgbGluayA9IGUudGFyZ2V0O1xyXG4gICAgICBsZXQgaW5kZXggPSBsaW5rLmRhdGFzZXQuaW5kZXg7XHJcbiAgICAgIG1vdmVDb250ZW50KGluZGV4KTtcclxuICAgIH0pXHJcbiAgfSlcclxuICBsZXQgYnV0dG9uID0gZC5xdWVyeVNlbGVjdG9yKCcuaW50cm8tYnV0dG9uJyk7XHJcbiAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgbW92ZUNvbnRlbnQoNyk7XHJcbiAgfSlcclxufVxyXG5PbmVQYWdlU2Nyb2xsKCk7IiwiY29uc3Qgb3ZlcmxheSA9IChmdW5jdGlvbigpe1xyXG4gIGxldCBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpO1xyXG4gIGxldCBtb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbCcpO1xyXG4gIGxldCBtb2RhbElubmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX19pbm5lcicpO1xyXG5cclxuICBsZXQgbW9kYWxUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgbW9kYWxUZXh0LmNsYXNzTGlzdC5hZGQoJ21vZGFsX190ZXh0Jyk7XHJcbiAgbGV0IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xyXG5cclxuICBsZXQgb3Blbk92ZXJsYXkgPSBmdW5jdGlvbihjb250ZW50LCByZXBseSkge1xyXG4gICAgbW9kYWxUZXh0LnRleHRDb250ZW50ID0gY29udGVudDtcclxuICAgIGlmKHJlcGx5KSB7XHJcbiAgICAgIGJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdvcmRlci1idXR0b24nKTtcclxuICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gJ9CX0LDQutGA0YvRgtGMJztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdtb2RhbF9fY2xvc2UnKTtcclxuICAgIH1cclxuICAgIG1vZGFsSW5uZXIuYXBwZW5kQ2hpbGQobW9kYWxUZXh0KTtcclxuICAgIG1vZGFsSW5uZXIuYXBwZW5kQ2hpbGQoYnV0dG9uKTtcclxuXHJcbiAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKCdpcy1hY3RpdmUnKTtcclxuICAgIGJvZHkuY2xhc3NMaXN0LmFkZCgnbG9ja2VkJyk7XHJcblxyXG4gICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICBjbG9zZU92ZXJsYXkoKTtcclxuICAgIH0pXHJcblxyXG4gICAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xyXG4gICAgICBpZiAoZS50YXJnZXQgPT09IG1vZGFsKSB7XHJcbiAgICAgICAgY2xvc2VPdmVybGF5KCk7XHJcbiAgICAgIH1cclxuICAgIH0pXHJcblxyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChlKSA9PiB7XHJcbiAgICAgIGlmIChlLmtleUNvZGUgPT09IDI3KSBcclxuICAgICAgICBjbG9zZU92ZXJsYXkoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbGV0IGNsb3NlT3ZlcmxheSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaXMtYWN0aXZlJyk7XHJcbiAgICBib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ2xvY2tlZCcpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIG9wZW46IG9wZW5PdmVybGF5LFxyXG4gICAgY2xvc2U6IGNsb3NlT3ZlcmxheVxyXG4gIH07XHJcbn0oKSk7XHJcblxyXG5jb25zdCBhamF4Rm9ybSA9IGZ1bmN0aW9uKGZvcm0pIHtcclxuICBsZXQgZGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gICAgZGF0YS5hcHBlbmQoXCJuYW1lXCIsIGZvcm0uZWxlbWVudHMubmFtZS52YWx1ZSk7XHJcbiAgICBkYXRhLmFwcGVuZChcInBob25lXCIsIGZvcm0uZWxlbWVudHMucGhvbmUudmFsdWUpO1xyXG4gICAgZGF0YS5hcHBlbmQoXCJjb21tZW50XCIsIGZvcm0uZWxlbWVudHMudGV4dGFyZWEudmFsdWUpO1xyXG4gICAgZGF0YS5hcHBlbmQoXCJ0b1wiLCBcImNsaWVudEBtYWlsLnJ1XCIpO1xyXG4gIFxyXG4gICAgY29uc3QgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XHJcbiAgICB4aHIucmVzcG9uc2VUeXBlID0gJ2pzb24nO1xyXG4gICAgeGhyLm9wZW4oJ1BPU1QnLCdodHRwczovL3dlYmRldi1hcGkubG9mdHNjaG9vbC5jb20vc2VuZG1haWwnKTtcclxuICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiWC1SZXF1ZXN0ZWQtV2l0aFwiLCBcIlhNTEh0dHBSZXF1ZXN0XCIpO1xyXG4gICAgeGhyLnNlbmQoZGF0YSk7XHJcblxyXG4gICAgcmV0dXJuIHhocjtcclxufVxyXG5cclxuY29uc3Qgc3VibWl0Rm9ybSA9IGZ1bmN0aW9uKGUpIHtcclxuICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgbGV0IGZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjb3JkZXItZm9ybScpO1xyXG4gIGxldCByZXF1ZXN0ID0gYWpheEZvcm0oZm9ybSk7ICBcclxuXHJcbiAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCk9PiB7XHJcbiAgICBsZXQgcmVwbHkgPSBmYWxzZTtcclxuICAgIGlmIChyZXF1ZXN0LnN0YXR1cyA+PTQwMCkge1xyXG4gICAgICBsZXQgY29udGVudCA9ICfQntGI0LjQsdC60LAg0YHQvtC10LTQuNC90LXQvdC40Y8g0YEg0YHQtdGA0LLQtdGA0L7QvCwg0L/QvtC/0YDQvtCx0YPQudGC0LUg0L/QvtC30LbQtSc7XHJcbiAgICAgIG92ZXJsYXkub3BlbihgJHtjb250ZW50fS4g0J7RiNC40LHQutCwICR7cmVxdWVzdC5zdGF0dXN9YCwgcmVwbHkpO1xyXG4gICAgfSBlbHNlIGlmIChyZXF1ZXN0LnJlc3BvbnNlLnN0YXR1cyA9PSAwKSB7XHJcbiAgICAgIGNvbnRlbnQgPSByZXF1ZXN0LnJlc3BvbnNlLm1lc3NhZ2U7XHJcbiAgICAgIG92ZXJsYXkub3Blbihjb250ZW50LCByZXBseSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb250ZW50ID0gJ9Ch0L7QvtCx0YnQtdC90LjQtSDQvtGC0L/RgNCw0LLQu9C10L3Qvic7XHJcbiAgICAgIHJlcGx5ID0gdHJ1ZTtcclxuICAgICAgb3ZlcmxheS5vcGVuKGNvbnRlbnQsIHJlcGx5KTtcclxuICAgIH1cclxuICB9KVxyXG59XHJcblxyXG5jb25zdCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI29yZGVyLWZvcm0nKTtcclxuZm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBzdWJtaXRGb3JtKTsiLCIoZnVuY3Rpb24oKSB7XHJcbiAgICBsZXQgZCA9IGRvY3VtZW50O1xyXG4gICAgbGV0IGxpc3QgPSBkLnF1ZXJ5U2VsZWN0b3IoJy5jYW5keS1iYXJfX2xpc3QnKTtcclxuICAgIGxldCBpdGVtQ291bnQgPSBkLnF1ZXJ5U2VsZWN0b3JBbGwoJy5jYW5keS1iYXJfX2l0ZW0nKS5sZW5ndGg7XHJcbiAgICBsZXQgc2xpZGVyID0gZC5xdWVyeVNlbGVjdG9yKCcuY2FuZHktYmFyX19zbGlkZXInKTtcclxuICAgIGxldCBiYWNrID0gZC5xdWVyeVNlbGVjdG9yKCcjYmFjaycpO1xyXG4gICAgbGV0IGZvcndhcmQgPSBkLnF1ZXJ5U2VsZWN0b3IoJyNmb3J3YXJkJyk7XHJcbiAgICBsZXQgcG9zID0gMDtcclxuICAgIHZhciBjbGllbnRYLCBjbGllbnRZO1xyXG5cclxuLy/QodC70LDQudC00LXRgFxyXG5cclxuICBmdW5jdGlvbiBzZXRUcmFuc2Zvcm0oKSB7XHJcbiAgICBsaXN0LnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGVYKCcrKC1wb3MgKiBzbGlkZXIub2Zmc2V0V2lkdGgpKydweCknO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcHJldiAoKSB7XHJcbiAgICBpZiAocG9zID09IDApe1xyXG4gICAgIHBvcyA9IGl0ZW1Db3VudCAtIDE7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBwb3MtLTtcclxuICAgIH1cclxuICAgIHNldFRyYW5zZm9ybSgpO1xyXG4gIH1cclxuICBmdW5jdGlvbiBuZXh0KCkge1xyXG4gICAgaWYgKHBvcyA9PSBpdGVtQ291bnQgLSAxKXtcclxuICAgICAgcG9zID0gMDtcclxuICAgIH0gZWxzZSB7IFxyXG4gICAgICBwb3MrKztcclxuICAgIH1cclxuICAgIHNldFRyYW5zZm9ybSgpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gdGhyb3R0bGUoZnVuYywgbXMpIHtcclxuICAgIHZhciBzdG9wID0gZmFsc2U7XHJcbiAgXHJcbiAgICBmdW5jdGlvbiB3cmFwKCkgeyAgXHJcbiAgICAgIGlmIChzdG9wKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgXHJcbiAgICAgIGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgIFxyXG4gICAgICBzdG9wID0gdHJ1ZTsgIFxyXG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHN0b3AgPSBmYWxzZTtcclxuICAgICAgfSwgbXMpO1xyXG4gICAgfSAgXHJcbiAgICByZXR1cm4gd3JhcDtcclxuICB9XHJcbiAgbGV0IHRyb3R0bGVQcmV2ID0gdGhyb3R0bGUocHJldiwgNjAwKTtcclxuICBsZXQgdHJvdHRsZU5leHQgPSB0aHJvdHRsZShuZXh0LCA2MDApO1xyXG5cclxuICBiYWNrLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdHJvdHRsZVByZXYpO1xyXG4gIGZvcndhcmQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0cm90dGxlTmV4dCk7XHJcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHNldFRyYW5zZm9ybSk7XHJcblxyXG4vL9Ce0LHRgNCw0LHQvtGC0LrQsCDRgdC+0LHRi9GC0LjRjyB0b3VjaFxyXG5cclxuICBzbGlkZXIuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIGZ1bmN0aW9uKGUpIHsgIFxyXG4gICAgY2xpZW50WCA9IGUudG91Y2hlc1swXS5jbGllbnRYO1xyXG4gICAgY2xpZW50WSA9IGUudG91Y2hlc1swXS5jbGllbnRZO1xyXG4gIH0sIGZhbHNlKTtcclxuXHJcbiAgc2xpZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgZnVuY3Rpb24oZSkge1xyXG4gICAgdmFyIGRlbHRhWCwgZGVsdGFZO1xyXG4gICAgXHJcbiAgICBkZWx0YVggPSBlLmNoYW5nZWRUb3VjaGVzWzBdLmNsaWVudFggLSBjbGllbnRYO1xyXG4gICAgZGVsdGFZID0gZS5jaGFuZ2VkVG91Y2hlc1swXS5jbGllbnRZIC0gY2xpZW50WTtcclxuICAgIHZhciBtb2QgPSBNYXRoLmFicyhkZWx0YVgpIC0gTWF0aC5hYnMoZGVsdGFZKTtcclxuXHJcbiAgICBpZiAoZGVsdGFYIDwgMCAmJiBtb2QgPiAwKSB7XHJcbiAgICAgIHRyb3R0bGVOZXh0KCk7XHJcbiAgICB9IGVsc2UgaWYgKGRlbHRhWCA+IDAgJiYgbW9kID4gMCkge1xyXG4gICAgICB0cm90dGxlUHJldigpO1xyXG4gICAgfSAgIFxyXG4gIH0sIGZhbHNlKTtcclxuXHJcbn0oKSk7IiwiKGZ1bmN0aW9uKCl7XHJcbiAgY29uc3QgaXRlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucmV2aWV3c19faXRlbScpO1xyXG4gIGNvbnN0IHBpeCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5yZXZpZXdzX19waXgtaXRlbScpO1xyXG4gIGxldCBhY3RpdmUgPSAwO1xyXG5cclxuICBmb3IgKGxldCBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICBwaXhbaV0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgaXRlbXNbaV0uY2xhc3NMaXN0LnRvZ2dsZSgnaXMtYWN0aXZlJyk7XHJcbiAgICAgIHBpeFtpXS5jbGFzc0xpc3QudG9nZ2xlKCdpcy1hY3RpdmUnKTtcclxuICAgICBcclxuICAgICAgcGl4W2FjdGl2ZV0uY2xhc3NMaXN0LnRvZ2dsZSgnaXMtYWN0aXZlJyk7XHJcbiAgICAgIGl0ZW1zW2FjdGl2ZV0uY2xhc3NMaXN0LnRvZ2dsZSgnaXMtYWN0aXZlJyk7XHJcbiAgICAgIGFjdGl2ZSA9IGk7ICAgICBcclxuICAgIH0pXHJcbiAgfVxyXG59KCkpOyJdfQ==
